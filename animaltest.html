<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>동물 성향 테스트</title>
    <link rel="stylesheet" href="./css/common.css">
    <style>

        body {
            margin: 20px;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2 {
            color: #333;
            font-size: 5rem;
            text-align: center;
        }
        .question {
            margin-bottom: 20px;
        }
        .results {
            margin-top: 20px;
            font-weight: bold;
        }
        .result-item {
            margin: 5px 0;
        }
        .hidden {
            display: none;
            border: 0px solid #000;
        }
        .progress {
            margin-bottom: 20px;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0;
            background-color: #ff0000; /* 빨간색 */
            transition: width 0.5s;
        }

        #quizForm {
          margin: 0 auto;
          width: 100%;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        #quizForm > div:first-child > p{
          width: 50rem;
          font-size: 2rem;
          margin-bottom: 2rem;
          font-weight: bold;
        }

        #quizForm > .question {
          display: flex;
          flex-direction: column;
          gap: 1rem 0;
          & label{
            font-size: 2rem;
            box-shadow:1px 1px 10px #aaa;
            padding: 1rem 2rem;
            margin: 0.5rem 0;
            border-radius: 2rem;
            &:hover{
              background-color: #eee;
            }
          }
        }
        .pagination {
            margin: 2rem 0;
            display: flex;
            justify-content: center;
            gap: 0 2rem;
        }
        .button {
            padding: 10px 30px;
            background-color: #76c7c0;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 2rem;
            &:hover{
              background-color: #538a85;
            }
        }
        h3 {
          margin: 0 auto;
          
          text-align: center;
          font-size: 2rem;
          background-color: #0fc;
          border-top-left-radius: 2rem;
          border-top-right-radius: 2rem;
        }
        .results{
          border: 1px solid #000;
          padding:2rem 2rem;
          margin: 0 auto;
          display: flex;
          align-content: center;
          text-align: center;
          width: 100%;
          gap: 0 2rem;
          flex-wrap: wrap;
          justify-content: center;
          & p{
            font-size: 2rem;
            flex-shrink:0;
          }
          & p:last-child{
            flex-grow:1;
            text-align: left;
          }
        }
        .results .refreshBtn{
          margin-top: 2rem;
          width: 100%;
          flex-grow: 1;
          height: 5rem;
          font-size: 2rem;
          background-color: transparent;
          transition : all 0.3s ease-in-out;
          cursor:pointer;
        }
        .refreshBtn:hover{
            background-color: #bbb;
            color :#0fc;
          }

          .main_container {
            background-image: url(./img/intro-bg-indigo.jpg);
            display: flex;
            align-items: center;
            justify-content: center;  
            text-align: center;
            width: 100%;
            height: 100vh;
            position: absolute;
            background-color: rgba(33,33,33,0.3);
            flex-wrap: wrap;
            gap: 0;
            & h1{
              width: 100%;
              color:#fff;
              text-shadow: 1px 1px 5px #ccc;
            }
          }
          .main_ctrl {
            /* border: 1px solid #000; */
            display: flex;
            flex-direction: row;
            justify-items: center;
            align-items: center;
            flex-wrap: wrap;
            & label {
              flex-shrink: 0;
              font-size: 3rem;
              width: 100%;
              padding-bottom: 0rem;
                }
            & input[type='text']{
              flex: 1;
                background-color: #333;
                color:#fff;
                font-size: 3rem;
              }
              & input[type='button']{
                flex-grow:1;
                border-radius: 10rem;
                padding: 1rem;
                font-size: 2rem;
                cursor:pointer;
              }
          }
          .imgFurry {
            transition : all 0.5s ease-in-out;
          }
    </style>
</head>
<body>
<div class="main_container">
  <h1>동물 성향 테스트(TEST. ver)</h1>
  <h1>이름을 입력해주세요</h1>
  <form class="main_ctrl" action="#" method="POST" id="nameForm">
    <input type="text" id="nameInput" value="" placeholder="이름을 입력하세요" required>
    <input type="button" id="startButton" value="시작하기">
  </form>
</div>
<h1>동물 성향 테스트</h1>
<div class="progress">
    <div class="progress-bar" id="progressBar"></div>
</div>

<form id="quizForm" action="https://formspree.io/f/xdkoejey"
method="POST">

</form>

<div class="pagination">
    <button class="button" id="prevButton" onclick="prevQuestion()">이전</button>
    <button class="button" id="nextButton" onclick="nextQuestion()">다음</button>  
</div>

<h3>결과창</h3>
<div class="results hidden" id="results">
  <img  class="imgFurry" src="" alt="" width="500">
  <input type="hidden" id="hiddenNameInput" name="name">  
</div>

<script>
function hideScreen() {
    const mainContainer = document.querySelector('.main_container');
    mainContainer.style.display = 'none'; // display를 none으로 설정하여 숨김
}

// 이벤트 리스너 추가
document.getElementById('startButton').addEventListener('click', hideScreen); // 버튼 클릭 시 화면 숨김
document.getElementById('nameInput').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') { // 엔터 키 입력 시
        hideScreen(); // 화면 숨김
    }
    event.preventDefault();
    console.log(event.which);

    const name = document.getElementById('nameInput').value;
    const saveName = document.getElementById('hiddenNameInput');
    saveName.value = name;
});
// 화면을 숨기는 함수



const questions = [
    // 사회적 상호작용 - 집단지향성
    "1. 나는 다른 사람과의 상호작용을 즐긴다.",
    "2. 나는 팀워크를 중요시한다.",
    "3. 나는 새로운 사람을 만나는 것을 좋아한다.",
    "4. 나는 친구와 시간을 보내는 것을 좋아한다.",
    // 사회적 상호작용 - 독립지향성
    "5. 나는 혼자 있는 시간을 필요로 한다.",
    "6. 나는 스스로 결정을 내리는 것을 선호한다.",
    "7. 나는 혼자서 문제를 해결하는 것을 좋아한다.",
    "8. 나는 혼자서도 충분히 만족할 수 있다.",
    // 의사결정 패턴 - 신중형
    "9. 나는 결정을 내릴 때 신중하게 생각한다.",
    "10. 나는 모든 가능성을 고려한 후 결정을 내린다.",
    "11. 나는 실수를 피하기 위해 연구하는 편이다.",
    "12. 나는 정보를 수집한 후 결정을 내린다.",
    // 의사결정 패턴 - 직관형
    "13. 나는 직감에 따라 결정을 내리는 편이다.",
    "14. 나는 즉각적인 피드백을 중시한다.",
    "15. 나는 감정에 따라 결정하는 경향이 있다.",
    "16. 나는 빠른 결정을 내리는 것을 선호한다.",
    // 자원관리 - 축적형
    "17. 나는 자원을 모으고 아끼는 편이다.",
    "18. 나는 필요한 것만 사는 것을 좋아한다.",
    "19. 나는 절약하는 것을 중요시한다.",
    "20. 나는 자원을 계획적으로 사용하는 편이다.",
    // 자원관리 - 기회활용형
    "21. 나는 기회를 찾는 것을 좋아한다.",
    "22. 나는 즉각적으로 자원을 활용하는 것을 선호한다.",
    "23. 나는 새로운 기회를 최대한 활용하려고 한다.",
    "24. 나는 위험을 감수하고 자원을 활용하는 편이다.",
    // 변화대응 - 안정지향형
    "25. 나는 안정된 환경을 선호한다.",
    "26. 나는 변화를 두려워하는 편이다.",
    "27. 나는 일관성을 중시한다.",
    "28. 나는 예측 가능한 상황에서 편안함을 느낀다.",
    // 변화대응 - 혁신지향형
    "29. 나는 변화를 수용하는 편이다.",
    "30. 나는 새로운 아이디어에 열려 있다.",
    "31. 나는 혁신적인 접근을 선호한다.",
    "32. 나는 변화하는 환경에 잘 적응한다."
];

const averages = {
    social: 12, // 사회적 상호작용 평균
    decision: 15, // 의사결정 패턴 평균
    resource: 14, // 자원 관리 평균
    change: 10 // 변화 대응 평균
};

let currentQuestionIndex = 0;
const answers = new Array(questions.length).fill(null); // 각 질문에 대한 답변을 저장할 배열

function loadQuestions(index) {
    const form = document.getElementById('quizForm');
    form.innerHTML = ''; // 이전 질문 초기화

    const question = questions[index];
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question';
    questionDiv.innerHTML = `
        <p>${question}</p>
        <label><input type="radio" name="q${index}" value="1" ${answers[index] === '1' ? 'checked' : ''}> 1. 매우 그렇지 않다</label>
        <label><input type="radio" name="q${index}" value="2" ${answers[index] === '2' ? 'checked' : ''}> 2. 그렇지 않다</label>
        <label><input type="radio" name="q${index}" value="3" ${answers[index] === '3' ? 'checked' : ''}> 3. 보통이다</label>
        <label><input type="radio" name="q${index}" value="4" ${answers[index] === '4' ? 'checked' : ''}> 4. 그렇다</label>
        <label><input type="radio" name="q${index}" value="5" ${answers[index] === '5' ? 'checked' : ''}> 5. 매우 그렇다</label>
    `;
    form.appendChild(questionDiv);
    updateProgress();
}

function updateProgress() {
    const progressBar = document.getElementById('progressBar');
    const percentage = ((currentQuestionIndex + 1) / questions.length) * 100;
    progressBar.style.width = percentage + '%';
}

function nextQuestion() {
    // 현재 질문의 답변 저장
    const currentAnswer = document.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
    if (currentAnswer) {
        answers[currentQuestionIndex] = currentAnswer.value;
    }

    if (currentQuestionIndex < questions.length - 1) {
        currentQuestionIndex++;
        loadQuestions(currentQuestionIndex);
    } else {
        calculateResult();
    }
}

function prevQuestion() {
    // 현재 질문의 답변 저장
    const currentAnswer = document.querySelector(`input[name="q${currentQuestionIndex}"]:checked`);
    if (currentAnswer) {
        answers[currentQuestionIndex] = currentAnswer.value;
    }

    if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        loadQuestions(currentQuestionIndex);
    }
}

function calculateResult() {
    const scores = { social: 0, decision: 0, resource: 0, change: 0 };
    const questionCount = questions.length;

    for (let i = 0; i < questionCount; i++) {
        const value = parseInt(answers[i]);
        if (isNaN(value)) continue; // 답변이 없으면 넘어감

        // 각 질문의 가중치를 계산하여 점수에 반영
        if (i < 8) { // 사회적 상호작용
            scores.social += value;
        } else if (i < 16) { // 의사결정 패턴
            scores.decision += value;
        } else if (i < 24) { // 자원 관리
            scores.resource += value;
        } else { // 변화 대응
            scores.change += value;
        }
    }

    // 결과 분석
    let result = [];
    for (const key in scores) {
        const average = averages[key];
        result.push(`${key.charAt(0).toUpperCase() + key.slice(1)}: ${scores[key]} (평균: ${average})`);
    }

     // 동물 매칭
     let animalResults = [];

     if (Object.values(scores).every(score => score === 0)) {
        // 점수가 모두 0일 경우 animalResults에 아무것도 추가하지 않음
        animalResults.push("결과를 도출할 수 없습니다."); // 필요시 메시지 추가
     }
     else{
    if (scores.social > scores.decision) {
        animalResults.push("늑대형: 사회적 상호작용을 중시하는 성격입니다.");
    } 
    else {
        animalResults.push("여우형: 독립적인 성격으로, 상황에 따라 유연하게 대처합니다.");
    }

    if (scores.decision > scores.resource) {
        animalResults.push("독수리형: 직관적으로 결정을 내리는 성격입니다.");
    } else {
        animalResults.push("비버형: 자원을 효율적으로 관리하는 성격입니다.");
    }

    if (scores.change > scores.social) {
        animalResults.push("돌고래형: 변화를 수용하고 새로운 아이디어에 열려 있습니다.");
    } else {
        animalResults.push("거북이형: 변화를 두려워하고 안정적인 환경을 선호합니다.");
    }
  }
    // 결과 표시
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = `<p>${result.join('<br>')}</p><p>${animalResults.join('<br>')}</p>
    <br><button class="refreshBtn" onclick="refreshPage()">처음으로</button> `;
    resultsDiv.classList.remove('hidden');

 // 결과 전송
 sendResults(); // 결과를 Formspree로 전송



}
function refreshPage() {
    location.reload();
}
// formspree에 결과 제출
function sendResults() {
        const resultsDiv = document.getElementById('results');
        const resultsText = resultsDiv.innerHTML;


        const formData = new FormData();
        formData.append('results', resultsText); // 결과 내용을 'results' 필드로 전송

        fetch('https://formspree.io/f/xdkoejey', {
            method: 'POST',
            body: formData,
            headers: {
                'Accept': 'application/json'
            }
        })
        .then(response => {
            if (response.ok) {
                alert('결과가 성공적으로 전송되었습니다!');
            } else {
                alert('결과 전송 중 오류가 발생했습니다. 다시 시도해 주세요.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('결과 전송 중 오류가 발생했습니다. 다시 시도해 주세요.');
        });
    }

loadQuestions(currentQuestionIndex);

// setInterval img change
const imgFurry = document.querySelector('.imgFurry');
const imgFurryArr = [
    "./img/furry/dolphin.jpg",
    "./img/furry/beaver.jpg",
    "./img/furry/eagle.jpg",
    "./img/furry/fox.jpg",
    "./img/furry/turtle.jpg",
    "./img/furry/wolf.jpg",
];
let currentIndex = 0;


// 처음 이미지를 생성해야 함
function initImages(){
  imgFurry.setAttribute('src', imgFurryArr[currentIndex]);
  imgFurry.style.opacity = 1;
}
function changeImages(){
  imgFurry.style.opacity = 0; // 현재 이미지의 opacity를 0으로 설정
        setTimeout(() => {
          currentIndex = (currentIndex + 1) % imgFurryArr.length;
            imgFurry.setAttribute('src', imgFurryArr[currentIndex]); // 이미지 소스 변경
            imgFurry.style.opacity = 1; // opacity를 1로 설정
        }, 500); // 150ms 후에 소스 변경
    
  };


initImages();
setInterval(changeImages, imgFurryArr.length * 3000);

</script>
</body>
</html>